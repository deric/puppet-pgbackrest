# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Classes

#### Public Classes

* [`pgbackrest`](#pgbackrest): Common parameters for both repository and stanza
* [`pgbackrest::repository`](#pgbackrest--repository): PostgreSQL backups storage
* [`pgbackrest::stanza`](#pgbackrest--stanza): A PostgeSQL database instance to be backed up

#### Private Classes

* `pgbackrest::config`: Manages ini config on backup (repository) server
* `pgbackrest::grants`: Configure grants for backup user
* `pgbackrest::install`: Install all required packages

### Defined types

#### Private Defined types

* `pgbackrest::cron_backup`: A cron job is exported from a database server, but could be executed elsewhere. Typically on a catalog (backup) server.

### Functions

* [`pgbackrest::ssh_key_path`](#pgbackrest--ssh_key_path): https://github.com/puppetlabs/puppet-specifications/blob/master/language/func-api.md#the-4x-api

### Data types

* [`Pgbackrest::BackupType`](#Pgbackrest--BackupType)
* [`Pgbackrest::CompressType`](#Pgbackrest--CompressType)
* [`Pgbackrest::HostKey`](#Pgbackrest--HostKey): ssh host keys
* [`Pgbackrest::Hour`](#Pgbackrest--Hour)
* [`Pgbackrest::LogLevel`](#Pgbackrest--LogLevel): Supported log levels
* [`Pgbackrest::Minute`](#Pgbackrest--Minute)
* [`Pgbackrest::Month`](#Pgbackrest--Month)
* [`Pgbackrest::Monthday`](#Pgbackrest--Monthday)
* [`Pgbackrest::Secret`](#Pgbackrest--Secret): Either plain-text password or Sensitive string
* [`Pgbackrest::Weekday`](#Pgbackrest--Weekday)

## Classes

### <a name="pgbackrest"></a>`pgbackrest`

Namespace for shared parameters.

#### Examples

##### In order to disable ssh keys management on both stanza (db server) and repository (backup server)

```puppet
pgbackrest::manage_ssh_key: false
```

#### Parameters

The following parameters are available in the `pgbackrest` class:

* [`manage_ssh_keys`](#-pgbackrest--manage_ssh_keys)
* [`manage_host_keys`](#-pgbackrest--manage_host_keys)
* [`manage_pgpass`](#-pgbackrest--manage_pgpass)
* [`manage_hba`](#-pgbackrest--manage_hba)
* [`manage_cron`](#-pgbackrest--manage_cron)
* [`purge_cron`](#-pgbackrest--purge_cron)
* [`host_group`](#-pgbackrest--host_group)
* [`host_key_type`](#-pgbackrest--host_key_type)
* [`package_name`](#-pgbackrest--package_name)
* [`package_ensure`](#-pgbackrest--package_ensure)
* [`db_name`](#-pgbackrest--db_name)
* [`db_user`](#-pgbackrest--db_user)
* [`backup_user`](#-pgbackrest--backup_user)
* [`ssh_user`](#-pgbackrest--ssh_user)
* [`backup_group`](#-pgbackrest--backup_group)
* [`config_dir`](#-pgbackrest--config_dir)
* [`backup_dir`](#-pgbackrest--backup_dir)
* [`log_dir`](#-pgbackrest--log_dir)
* [`spool_dir`](#-pgbackrest--spool_dir)

##### <a name="-pgbackrest--manage_ssh_keys"></a>`manage_ssh_keys`

Data type: `Boolean`



Default value: `false`

##### <a name="-pgbackrest--manage_host_keys"></a>`manage_host_keys`

Data type: `Boolean`

Whether ssh host keys should be exported from database server and imported on repository server

Default value: `true`

##### <a name="-pgbackrest--manage_pgpass"></a>`manage_pgpass`

Data type: `Boolean`



Default value: `true`

##### <a name="-pgbackrest--manage_hba"></a>`manage_hba`

Data type: `Boolean`



Default value: `true`

##### <a name="-pgbackrest--manage_cron"></a>`manage_cron`

Data type: `Boolean`



Default value: `true`

##### <a name="-pgbackrest--purge_cron"></a>`purge_cron`

Data type: `Boolean`



Default value: `true`

##### <a name="-pgbackrest--host_group"></a>`host_group`

Data type: `String`



Default value: `'common'`

##### <a name="-pgbackrest--host_key_type"></a>`host_key_type`

Data type: `Pgbackrest::HostKey`

ssh host key fingerprint, one of 'ecdsa', 'ed25519' or 'rsa'. Default: `ed25519`

Default value: `'ed25519'`

##### <a name="-pgbackrest--package_name"></a>`package_name`

Data type: `String`

System package to be installed

Default value: `'pgbackrest'`

##### <a name="-pgbackrest--package_ensure"></a>`package_ensure`

Data type: `String`

`installed` or specific version

Default value: `'present'`

##### <a name="-pgbackrest--db_name"></a>`db_name`

Data type: `String`



Default value: `'backup'`

##### <a name="-pgbackrest--db_user"></a>`db_user`

Data type: `String`



Default value: `'backup'`

##### <a name="-pgbackrest--backup_user"></a>`backup_user`

Data type: `String`



Default value: `'backup'`

##### <a name="-pgbackrest--ssh_user"></a>`ssh_user`

Data type: `String`



Default value: `'postgres'`

##### <a name="-pgbackrest--backup_group"></a>`backup_group`

Data type: `String`

Unix account used (mainly) for storing backups

Default value: `'backup'`

##### <a name="-pgbackrest--config_dir"></a>`config_dir`

Data type: `Stdlib::AbsolutePath`



Default value: `'/etc/pgbackrest'`

##### <a name="-pgbackrest--backup_dir"></a>`backup_dir`

Data type: `Stdlib::AbsolutePath`



Default value: `'/var/lib/pgbackrest'`

##### <a name="-pgbackrest--log_dir"></a>`log_dir`

Data type: `Stdlib::AbsolutePath`



Default value: `'/var/log/pgbackrest'`

##### <a name="-pgbackrest--spool_dir"></a>`spool_dir`

Data type: `Stdlib::AbsolutePath`



Default value: `'/var/spool/pgbackrest'`

### <a name="pgbackrest--repository"></a>`pgbackrest::repository`

Configures pgBackRest backup server that can perform remote backups

#### Examples

##### 

```puppet
include pgbackrest::repository
```

#### Parameters

The following parameters are available in the `pgbackrest::repository` class:

* [`fqdn`](#-pgbackrest--repository--fqdn)
* [`backup_dir`](#-pgbackrest--repository--backup_dir)
* [`spool_dir`](#-pgbackrest--repository--spool_dir)
* [`dir_mode`](#-pgbackrest--repository--dir_mode)
* [`log_dir`](#-pgbackrest--repository--log_dir)
* [`exported_ipaddress`](#-pgbackrest--repository--exported_ipaddress)
* [`user`](#-pgbackrest--repository--user)
* [`group`](#-pgbackrest--repository--group)
* [`user_ensure`](#-pgbackrest--repository--user_ensure)
* [`user_shell`](#-pgbackrest--repository--user_shell)
* [`host_key_type`](#-pgbackrest--repository--host_key_type)
* [`purge_cron`](#-pgbackrest--repository--purge_cron)
* [`manage_dirs`](#-pgbackrest--repository--manage_dirs)
* [`manage_ssh_keys`](#-pgbackrest--repository--manage_ssh_keys)
* [`manage_host_keys`](#-pgbackrest--repository--manage_host_keys)
* [`manage_pgpass`](#-pgbackrest--repository--manage_pgpass)
* [`manage_hba`](#-pgbackrest--repository--manage_hba)
* [`manage_cron`](#-pgbackrest--repository--manage_cron)
* [`manage_user`](#-pgbackrest--repository--manage_user)
* [`manage_config`](#-pgbackrest--repository--manage_config)
* [`uid`](#-pgbackrest--repository--uid)
* [`config_dir`](#-pgbackrest--repository--config_dir)
* [`config_file`](#-pgbackrest--repository--config_file)
* [`host_group`](#-pgbackrest--repository--host_group)
* [`hba_entry_order`](#-pgbackrest--repository--hba_entry_order)
* [`db_name`](#-pgbackrest--repository--db_name)
* [`db_user`](#-pgbackrest--repository--db_user)
* [`ssh_user`](#-pgbackrest--repository--ssh_user)
* [`ssh_key_type`](#-pgbackrest--repository--ssh_key_type)
* [`config`](#-pgbackrest--repository--config)

##### <a name="-pgbackrest--repository--fqdn"></a>`fqdn`

Data type: `String`



Default value: `$facts['networking']['fqdn']`

##### <a name="-pgbackrest--repository--backup_dir"></a>`backup_dir`

Data type: `Stdlib::AbsolutePath`

Directory for storing backups

Default value: `$pgbackrest::backup_dir`

##### <a name="-pgbackrest--repository--spool_dir"></a>`spool_dir`

Data type: `Stdlib::AbsolutePath`



Default value: `$pgbackrest::spool_dir`

##### <a name="-pgbackrest--repository--dir_mode"></a>`dir_mode`

Data type: `String`



Default value: `'0750'`

##### <a name="-pgbackrest--repository--log_dir"></a>`log_dir`

Data type: `Stdlib::AbsolutePath`



Default value: `$pgbackrest::log_dir`

##### <a name="-pgbackrest--repository--exported_ipaddress"></a>`exported_ipaddress`

Data type: `String`



Default value: `"${facts['networking']['ip']}/32"`

##### <a name="-pgbackrest--repository--user"></a>`user`

Data type: `String`

Local user account used for running and storing backups in its home dir.

Default value: `$pgbackrest::backup_user`

##### <a name="-pgbackrest--repository--group"></a>`group`

Data type: `String`

Primary group of backup user

Default value: `$pgbackrest::backup_group`

##### <a name="-pgbackrest--repository--user_ensure"></a>`user_ensure`

Data type: `Enum['present', 'absent']`



Default value: `'present'`

##### <a name="-pgbackrest--repository--user_shell"></a>`user_shell`

Data type: `String`

Backup user shell

Default value: `'/bin/bash'`

##### <a name="-pgbackrest--repository--host_key_type"></a>`host_key_type`

Data type: `String`



Default value: `$pgbackrest::host_key_type`

##### <a name="-pgbackrest--repository--purge_cron"></a>`purge_cron`

Data type: `Boolean`

Remove cron jobs not managed by Puppet

Default value: `false`

##### <a name="-pgbackrest--repository--manage_dirs"></a>`manage_dirs`

Data type: `Boolean`

Whether directories should be managed by Puppet

Default value: `true`

##### <a name="-pgbackrest--repository--manage_ssh_keys"></a>`manage_ssh_keys`

Data type: `Boolean`



Default value: `$pgbackrest::manage_ssh_keys`

##### <a name="-pgbackrest--repository--manage_host_keys"></a>`manage_host_keys`

Data type: `Boolean`



Default value: `$pgbackrest::manage_host_keys`

##### <a name="-pgbackrest--repository--manage_pgpass"></a>`manage_pgpass`

Data type: `Boolean`



Default value: `$pgbackrest::manage_pgpass`

##### <a name="-pgbackrest--repository--manage_hba"></a>`manage_hba`

Data type: `Boolean`



Default value: `$pgbackrest::manage_hba`

##### <a name="-pgbackrest--repository--manage_cron"></a>`manage_cron`

Data type: `Boolean`



Default value: `$pgbackrest::manage_cron`

##### <a name="-pgbackrest--repository--manage_user"></a>`manage_user`

Data type: `Boolean`



Default value: `true`

##### <a name="-pgbackrest--repository--manage_config"></a>`manage_config`

Data type: `Boolean`



Default value: `true`

##### <a name="-pgbackrest--repository--uid"></a>`uid`

Data type: `Optional[Integer]`



Default value: `undef`

##### <a name="-pgbackrest--repository--config_dir"></a>`config_dir`

Data type: `Stdlib::AbsolutePath`



Default value: `$pgbackrest::config_dir`

##### <a name="-pgbackrest--repository--config_file"></a>`config_file`

Data type: `String`



Default value: `'pgbackrest.conf'`

##### <a name="-pgbackrest--repository--host_group"></a>`host_group`

Data type: `String`



Default value: `$pgbackrest::host_group`

##### <a name="-pgbackrest--repository--hba_entry_order"></a>`hba_entry_order`

Data type: `Integer`



Default value: `50`

##### <a name="-pgbackrest--repository--db_name"></a>`db_name`

Data type: `String`



Default value: `$pgbackrest::db_name`

##### <a name="-pgbackrest--repository--db_user"></a>`db_user`

Data type: `String`



Default value: `$pgbackrest::db_user`

##### <a name="-pgbackrest--repository--ssh_user"></a>`ssh_user`

Data type: `String`



Default value: `$pgbackrest::ssh_user`

##### <a name="-pgbackrest--repository--ssh_key_type"></a>`ssh_key_type`

Data type: `String`



Default value: `'ed25519'`

##### <a name="-pgbackrest--repository--config"></a>`config`

Data type: `Hash`



Default value: `{}`

### <a name="pgbackrest--stanza"></a>`pgbackrest::stanza`

Manages configuration for postgresql database backup

 Default: /var/lib/pgbackrest

#### Examples

##### 

```puppet
include pgbackrest::stanza
```

#### Parameters

The following parameters are available in the `pgbackrest::stanza` class:

* [`id`](#-pgbackrest--stanza--id)
* [`cluster`](#-pgbackrest--stanza--cluster)
* [`host_group`](#-pgbackrest--stanza--host_group)
* [`repo`](#-pgbackrest--stanza--repo)
* [`version`](#-pgbackrest--stanza--version)
* [`address`](#-pgbackrest--stanza--address)
* [`port`](#-pgbackrest--stanza--port)
* [`db_name`](#-pgbackrest--stanza--db_name)
* [`db_user`](#-pgbackrest--stanza--db_user)
* [`db_path`](#-pgbackrest--stanza--db_path)
* [`db_cluster`](#-pgbackrest--stanza--db_cluster)
* [`db_password`](#-pgbackrest--stanza--db_password)
* [`seed`](#-pgbackrest--stanza--seed)
* [`backup_dir`](#-pgbackrest--stanza--backup_dir)
* [`spool_dir`](#-pgbackrest--stanza--spool_dir)
* [`backups`](#-pgbackrest--stanza--backups)
* [`ssh_user`](#-pgbackrest--stanza--ssh_user)
* [`ssh_port`](#-pgbackrest--stanza--ssh_port)
* [`log_level_console`](#-pgbackrest--stanza--log_level_console)
* [`archive_timeout`](#-pgbackrest--stanza--archive_timeout)
* [`binary`](#-pgbackrest--stanza--binary)
* [`redirect_console`](#-pgbackrest--stanza--redirect_console)
* [`manage_dbuser`](#-pgbackrest--stanza--manage_dbuser)
* [`manage_ssh_keys`](#-pgbackrest--stanza--manage_ssh_keys)
* [`manage_host_keys`](#-pgbackrest--stanza--manage_host_keys)
* [`manage_pgpass`](#-pgbackrest--stanza--manage_pgpass)
* [`manage_hba`](#-pgbackrest--stanza--manage_hba)
* [`manage_cron`](#-pgbackrest--stanza--manage_cron)
* [`host_key_type`](#-pgbackrest--stanza--host_key_type)
* [`ssh_key_type`](#-pgbackrest--stanza--ssh_key_type)
* [`log_dir`](#-pgbackrest--stanza--log_dir)
* [`backup_user`](#-pgbackrest--stanza--backup_user)
* [`log_level_file`](#-pgbackrest--stanza--log_level_file)
* [`compress_type`](#-pgbackrest--stanza--compress_type)
* [`compress_level`](#-pgbackrest--stanza--compress_level)
* [`process_max`](#-pgbackrest--stanza--process_max)

##### <a name="-pgbackrest--stanza--id"></a>`id`

Data type: `String`

Unique identified

Default value: `$facts['networking']['hostname']`

##### <a name="-pgbackrest--stanza--cluster"></a>`cluster`

Data type: `Optional[String]`

Cluster name in case database has primary and some replicas.

Default value: `undef`

##### <a name="-pgbackrest--stanza--host_group"></a>`host_group`

Data type: `String`

Default repository host group

Default value: `$pgbackrest::host_group`

##### <a name="-pgbackrest--stanza--repo"></a>`repo`

Data type: `Integer[1,256]`

Set the repository for a command to operate on, default: 1

Default value: `1`

##### <a name="-pgbackrest--stanza--version"></a>`version`

Data type: `String`

PostgreSQL major version, e.g. '16'

Default value: `lookup('postgresql::globals::version')`

##### <a name="-pgbackrest--stanza--address"></a>`address`

Data type: `String`



Default value: `$facts['networking']['fqdn']`

##### <a name="-pgbackrest--stanza--port"></a>`port`

Data type: `Integer`



Default value: `5432`

##### <a name="-pgbackrest--stanza--db_name"></a>`db_name`

Data type: `String`



Default value: `$pgbackrest::db_name`

##### <a name="-pgbackrest--stanza--db_user"></a>`db_user`

Data type: `String`



Default value: `$pgbackrest::db_user`

##### <a name="-pgbackrest--stanza--db_path"></a>`db_path`

Data type: `Stdlib::AbsolutePath`

Typically postgres home directory

Default value: `'/var/lib/postgresql'`

##### <a name="-pgbackrest--stanza--db_cluster"></a>`db_cluster`

Data type: `String`

PostgreSQL cluster name, default: main

Default value: `'main'`

##### <a name="-pgbackrest--stanza--db_password"></a>`db_password`

Data type: `Optional[Pgbackrest::Secret]`



Default value: `undef`

##### <a name="-pgbackrest--stanza--seed"></a>`seed`

Data type: `Optional[String]`

Random password seed

Default value: `undef`

##### <a name="-pgbackrest--stanza--backup_dir"></a>`backup_dir`

Data type: `Stdlib::AbsolutePath`

Directory where backups will be stored (might be located on remote server)

Default value: `$pgbackrest::backup_dir`

##### <a name="-pgbackrest--stanza--spool_dir"></a>`spool_dir`

Data type: `Stdlib::AbsolutePath`

Path where transient data is stored (should be on local filesystem)
Default: /var/spool/pgbackrest

Default value: `$pgbackrest::spool_dir`

##### <a name="-pgbackrest--stanza--backups"></a>`backups`

Data type: `Optional[Hash]`



Default value: `undef`

##### <a name="-pgbackrest--stanza--ssh_user"></a>`ssh_user`

Data type: `String`

user used for ssh connection to the DB instance

Default value: `'postgres'`

##### <a name="-pgbackrest--stanza--ssh_port"></a>`ssh_port`

Data type: `Integer`

ssh port used for connection to the DB instance from catalog server

Default value: `22`

##### <a name="-pgbackrest--stanza--log_level_console"></a>`log_level_console`

Data type: `Pgbackrest::LogLevel`

Logging level, default: 'warn'
Possible values 'off', 'error', 'warn', 'info', 'detail', 'debug', 'trace'

Default value: `'warn'`

##### <a name="-pgbackrest--stanza--archive_timeout"></a>`archive_timeout`

Data type: `Optional[Integer]`

Set maximum time, in seconds, to wait for each WAL segment to reach the pgBackRest archive repository

Default value: `undef`

##### <a name="-pgbackrest--stanza--binary"></a>`binary`

Data type: `Optional[Stdlib::AbsolutePath]`

Full path to backup executable.

Default value: `undef`

##### <a name="-pgbackrest--stanza--redirect_console"></a>`redirect_console`

Data type: `Boolean`

Redirect console output to a log file (make sense especially with custom backup command)

Default value: `false`

##### <a name="-pgbackrest--stanza--manage_dbuser"></a>`manage_dbuser`

Data type: `Boolean`



Default value: `true`

##### <a name="-pgbackrest--stanza--manage_ssh_keys"></a>`manage_ssh_keys`

Data type: `Boolean`



Default value: `$pgbackrest::manage_ssh_keys`

##### <a name="-pgbackrest--stanza--manage_host_keys"></a>`manage_host_keys`

Data type: `Boolean`



Default value: `$pgbackrest::manage_host_keys`

##### <a name="-pgbackrest--stanza--manage_pgpass"></a>`manage_pgpass`

Data type: `Boolean`



Default value: `$pgbackrest::manage_pgpass`

##### <a name="-pgbackrest--stanza--manage_hba"></a>`manage_hba`

Data type: `Boolean`



Default value: `$pgbackrest::manage_hba`

##### <a name="-pgbackrest--stanza--manage_cron"></a>`manage_cron`

Data type: `Boolean`



Default value: `$pgbackrest::manage_cron`

##### <a name="-pgbackrest--stanza--host_key_type"></a>`host_key_type`

Data type: `String`



Default value: `$pgbackrest::host_key_type`

##### <a name="-pgbackrest--stanza--ssh_key_type"></a>`ssh_key_type`

Data type: `String`



Default value: `'ed25519'`

##### <a name="-pgbackrest--stanza--log_dir"></a>`log_dir`

Data type: `Stdlib::AbsolutePath`



Default value: `$pgbackrest::log_dir`

##### <a name="-pgbackrest--stanza--backup_user"></a>`backup_user`

Data type: `String`



Default value: `$pgbackrest::backup_user`

##### <a name="-pgbackrest--stanza--log_level_file"></a>`log_level_file`

Data type: `Pgbackrest::LogLevel`



Default value: `'info'`

##### <a name="-pgbackrest--stanza--compress_type"></a>`compress_type`

Data type: `Pgbackrest::CompressType`



Default value: `'gz'`

##### <a name="-pgbackrest--stanza--compress_level"></a>`compress_level`

Data type: `Optional[Integer[0,9]]`



Default value: `undef`

##### <a name="-pgbackrest--stanza--process_max"></a>`process_max`

Data type: `Optional[Integer[1,999]]`



Default value: `undef`

## Functions

### <a name="pgbackrest--ssh_key_path"></a>`pgbackrest::ssh_key_path`

Type: Ruby 4.x API

https://github.com/puppetlabs/puppet-specifications/blob/master/language/func-api.md#the-4x-api

#### `pgbackrest::ssh_key_path(String $ssh_dir, String $ssh_type, Boolean $pubkey)`

https://github.com/puppetlabs/puppet-specifications/blob/master/language/func-api.md#the-4x-api

Returns: `String`

##### `ssh_dir`

Data type: `String`



##### `ssh_type`

Data type: `String`



##### `pubkey`

Data type: `Boolean`



## Data types

### <a name="Pgbackrest--BackupType"></a>`Pgbackrest::BackupType`

The Pgbackrest::BackupType data type.

Alias of `Enum['full', 'incr', 'delta']`

### <a name="Pgbackrest--CompressType"></a>`Pgbackrest::CompressType`

The Pgbackrest::CompressType data type.

Alias of `Enum['none', 'bz2', 'gz', 'lz4', 'zst']`

### <a name="Pgbackrest--HostKey"></a>`Pgbackrest::HostKey`

ssh host keys

Alias of `Enum['ecdsa', 'ed25519', 'rsa']`

### <a name="Pgbackrest--Hour"></a>`Pgbackrest::Hour`

The Pgbackrest::Hour data type.

Alias of `Variant[Integer[0,23], String, Tuple[Variant[String, Integer[0,23]], 1, default]]`

### <a name="Pgbackrest--LogLevel"></a>`Pgbackrest::LogLevel`

Supported log levels

Alias of `Enum['off', 'error', 'warn', 'info', 'detail', 'debug', 'trace']`

### <a name="Pgbackrest--Minute"></a>`Pgbackrest::Minute`

The Pgbackrest::Minute data type.

Alias of `Variant[Integer[0,59], String, Tuple[Variant[String, Integer[0,59]], 1, default]]`

### <a name="Pgbackrest--Month"></a>`Pgbackrest::Month`

The Pgbackrest::Month data type.

Alias of `Variant[Integer[1,12], String, Tuple[Variant[String, Integer[1,12]], 1, default]]`

### <a name="Pgbackrest--Monthday"></a>`Pgbackrest::Monthday`

The Pgbackrest::Monthday data type.

Alias of `Variant[Integer[1,31], String, Tuple[Variant[String, Integer[1,31]], 1, default]]`

### <a name="Pgbackrest--Secret"></a>`Pgbackrest::Secret`

Either plain-text password or Sensitive string

Alias of `Variant[String, Sensitive[String]]`

### <a name="Pgbackrest--Weekday"></a>`Pgbackrest::Weekday`

The Pgbackrest::Weekday data type.

Alias of `Variant[Integer[0,7], String, Tuple[Variant[String, Integer[0,7]], 1, default]]`

